<script>
import { Notify } from 'quasar'
import { mapActions, mapGetters, mapMutations } from 'vuex'

export default {
  name: 'App',

  computed: {
    ...mapGetters('layout', ['alert'])
  },

  watch: {
    alert: function (value) {
      Notify.create({
        type: value.level,
        message: value.content,
        position: 'top',
        timeout: 9999999999,
        actions: [
          { icon: 'fas fa-times', color: 'white', handler: this.dismissAlert }
        ]
      })
    }
  },

  async beforeMount () {
    await this.autoLogin()
    await this.initConfigs()
    await this.loadAlert()
  },

  async mounted () {
    if (this.$store.$error) {
      this.$router.push({ path: '/error' })
    }
  },

  methods: {
    ...mapActions('accounts', ['autoLogin']),
    ...mapActions('dao', ['initConfigs']),
    ...mapActions('layout', ['loadAlert']),
    ...mapMutations('layout', ['dismissAlert'])
  }
}
</script>

<template lang="pug">
#q-app
  router-view
</template>

<style lang="stylus">

</style>
